{"version":3,"sources":["app.min.js"],"names":["MyApp","angular","module","config","$stateProvider","$urlRouterProvider","otherwise","state","url","templateUrl","controller","controllerAs","service","$http","$window","this","syncMethod","getRooms","get","then","response","data","err","console","error","getRoom","roomId","createRoom","room","successEvent","post","defaults","headers","common","token","sessionStorage","sendMessage","msg","getUsersForRoom","findUserByName","name","blockUser","userId","put","user","JSON","stringify","unblockUser","getBlockedUsers","setMembership","role","login","failEvent","register","editProfile","editRoom","roomPassword","pw","getSessionToken","getSessionUser","undefined","parse","logout","$scope","$location","ApiService","refreshBlockedUsers","users","blockedUsers","onUnblock","onEdit","setCurrentUser","path","nickname","currentUser","email","avatar","avatarFileType","_id","$watch","newValue","oldValue","scope","filesize","errormsg","base64","filetype","submit","showAvatar","onSentPassword","getInRoom","rooms","reverse","forEach","messages","attemptRoom","log","passwordHash","pushRoom","sendPassword","formatDate","date","Date","toLocaleString","chooseRoomColor","index","forbidden","Math","floor","directive","onLoggedIn","onError","ImgService","userLoggedIn","skip","openRooms","r","toString","push","removeRoom","splice","indexOf","showImage","filter","toggleFilter","onRegister","password","$stateParams","$anchorScroll","refreshMessages","x","moderator","refreshUsers","equals","members","editSuccess","setTimeout","hash","newroom","inviteonly","unlisted","autorefresh","setInterval","send","newmsg","changePassword","userToFind","foundUser","setMemberShip","refUsers","$on","clearInterval","onCreatedRoom"],"mappings":"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","file":"app.min.js","sourcesContent":["var MyApp = angular.module(\"MyApp\", [\"ui.router\", \"naif.base64\"]);\n\nMyApp.config([\"$stateProvider\", \"$urlRouterProvider\", function ($stateProvider, $urlRouterProvider) {\n  $urlRouterProvider.otherwise(\"/intro\");\n\n  $stateProvider\n    .state(\"main\", {\n      url: \"/\",\n      templateUrl: \"templates/main/main.html\",\n      controller: \"MainController\",\n      controllerAs: \"main\",\n    })\n    .state(\"main.intro\", {\n      url: \"intro\",\n      templateUrl: \"templates/intro/intro.html\",\n      controller: \"IntroController\",\n      controllerAs: \"intro\"\n    })\n    .state(\"main.room\", {\n      url: \"chatroom/:roomId\",\n      templateUrl: \"templates/room/room.html\",\n      controller: \"RoomController\",\n      controllerAs: \"room\"\n    })\n    .state(\"main.newroom\", {\n      url: \"newroom\",\n      templateUrl: \"templates/newroom/newroom.html\",\n      controller: \"NewRoomController\",\n      controllerAs: \"newroom\"\n    })\n    .state(\"main.login\", {\n      url: \"signin\",\n      templateUrl: \"templates/login/login.html\",\n      controller: \"LoginController\",\n      controllerAs: \"login\"\n    })\n    .state(\"main.register\", {\n      url: \"register\",\n      templateUrl: \"templates/register/register.html\",\n      controller: \"RegisterController\",\n      controllerAs: \"register\"\n    })\n    .state(\"main.edituser\", {\n      url: \"edituser\",\n      templateUrl: \"templates/edituser/edituser.html\",\n      controller: \"EditUserController\",\n      controllerAs: \"edituser\"\n    })\n    .state(\"main.other\", {\n      url: \"other\",\n      templateUrl: \"templates/other/other.html\",\n    });\n}]);\n\nMyApp.service(\"ApiService\", [\"$http\", \"$window\", function ($http, $window) {\n  this.syncMethod = function () {\n    return 0;\n  };\n\n//  var path = window.env.API_URL;\n//  console.log(path);\n\n  this.getRooms = function () {\n    return $http.get(\"/room\")\n      .then(function (response) {\n        return response.data;\n      })\n      .catch(function (err) {\n        console.error(\"Error ApiService getRooms \", err);\n        return {};\n      });\n  };\n\n  this.getRoom = function (roomId) {\n    return $http.get(\"/room/\" + roomId)\n      .then(function (response) {\n        return response.data;\n      })\n      .catch(function (err) {\n        console.error(\"Error ApiService getRoom \", err);\n        return {};\n      });\n  };\n  \n  this.createRoom = function (room, successEvent) {\n    return $http.post(\"/room\", room)\n      .then (function (response) {\n        $http.defaults.headers.common['X-Access-Token'] = response.data.token;\n        $window.sessionStorage.token = response.data.token;\n        successEvent(response.data);\n      },\n      function (response) {\n        console.error(\"Error room could not be created: \" + response.data)\n      });\n  }\n  \n  this.sendMessage = function (roomId, msg, successEvent) {\n    return $http.post(\"/room/\" + roomId + \"/message\", msg)\n      .then(function (response) {\n        successEvent(response.data);\n      },\n      function (response) {\n        console.error(\"Error message could not be sent: \" + response.data);\n      });\n  };\n\n  this.getUsersForRoom = function (roomId) {\n    return $http.get(\"/room/\" + roomId + \"/member\")\n      .then (function (response) {\n        return response.data;\n      })\n      .catch(function (err) {\n        console.error(\"Error ApiService getUsersForRoom \", err);\n        return {};\n      });\n  };\n  \n  this.findUserByName = function (name) {\n    return $http.get(\"/user/\" + name)\n      .then (function (response) {\n        return response.data;\n      })\n      .catch(function (err) {\n        console.error(\"Error ApiService findUserByName \", err);\n        return {};\n      });\n  };\n  \n  this.blockUser = function (userId, successEvent) {\n    return $http.put(\"/user/\" + userId + \"/block\")\n      .then (function (response) {\n        $http.defaults.headers.common['X-Access-Token'] = response.data.token;\n        $window.sessionStorage.token = response.data.token;\n        $window.sessionStorage.user = JSON.stringify(response.data.user);\n        successEvent(response.data);\n      },\n      function (response) {\n        console.error(\"Error ApiService blockUser \", response.data);\n      });\n  };\n\n  this.unblockUser = function (userId, successEvent) {\n    return $http.put(\"/user/\" + userId + \"/unblock\")\n      .then (function (response) {\n        $http.defaults.headers.common['X-Access-Token'] = response.data.token;\n        $window.sessionStorage.token = response.data.token;\n        $window.sessionStorage.user = JSON.stringify(response.data.user);\n        successEvent(response.data);\n      },\n      function (response) {\n        console.error(\"Error ApiService blockUser \", response.data);\n      });\n  };\n  \n  this.getBlockedUsers = function () {\n    return $http.get(\"/blockedusers\")\n      .then (function (response) {\n        return response.data;\n      })\n      .catch(function (err) {\n        console.error(\"Error ApiService getBlockedUsers \", err);\n        return {};\n      });\n  };\n  \n  this.setMembership = function (userId, roomId, role, successEvent) {\n    return $http.post(\"/room/\" + roomId + \"/member\", {userId: userId, role: role})\n      .then (function (response) {\n        successEvent(response.data);\n      },\n      function (response) {\n        console.error(\"Error ApiService setMembership \", response.data);\n      });\n  };\n  \n  this.login = function (user, successEvent, failEvent) {\n    return $http.post(\"/login\", user)\n      .then(function (response) {\n        $http.defaults.headers.common['X-Access-Token'] = response.data.token;\n        $window.sessionStorage.token = response.data.token;\n        $window.sessionStorage.user = JSON.stringify(response.data.user);\n        successEvent(response.data);\n      },\n      function (response) {\n        failEvent(response.data);\n      });\n  };\n\n  this.register = function (user, successEvent) {\n    return $http.post(\"/user\", user)\n      .then(function (response) {\n        successEvent();\n      },\n      function (response) {\n        console.error(\"Error ApiService register: \" + response.data);\n      });\n  };\n  \n  this.editProfile = function(user, successEvent) {\n    return $http.put(\"/user\", user)\n      .then(function (response) {\n        $window.sessionStorage.user = JSON.stringify(user);\n        successEvent(user);\n      },\n      function (response) {\n        console.error(\"Error ApiService editProfile: \" + response.data);\n      });\n  };\n  \n  this.editRoom = function(roomId, room, successEvent) {\n    return $http.put(\"/room/\" + roomId, room)\n      .then(function (response) {\n        successEvent(room);\n      },\n      function (response) {\n        console.error(\"Error ApiService editRoom: \" + response.data);\n      });\n  };\n\n  this.roomPassword = function (roomId, pw, successEvent) {\n    return $http.post(\"/room/\" + roomId, pw)\n      .then(function (response) {\n        $http.defaults.headers.common['X-Access-Token'] = response.data.token;\n        $window.sessionStorage.token = response.data.token;\n        successEvent(response.data);\n      },\n      function (response) {\n        console.error(\"Error password could not be sent: \" + response.data);\n      });\n  };\n  \n  this.getSessionToken = function () {\n    $http.defaults.headers.common['X-Access-Token'] = $window.sessionStorage.token;\n  };\n  \n  this.getSessionUser = function() {\n    var user = $window.sessionStorage.user;\n    if (user == undefined || user == \"undefined\" || user == null)\n      return undefined;\n    return JSON.parse($window.sessionStorage.user);\n  };\n  \n  this.logout = function() {\n    delete $http.defaults.headers.common['X-Access-Token'];\n    delete $window.sessionStorage.token;\n    delete $window.sessionStorage.user;\n  };\n}]);\n\nMyApp.controller(\"EditUserController\", [\"$scope\", \"$location\", \"ApiService\", function ($scope, $location, ApiService) {\n  $scope.blockedUsers = [];\n  refreshBlockedUsers();\n  $scope.user = {\n    nickname: $scope.currentUser.nickname,\n    email: $scope.currentUser.email,\n    avatar: $scope.currentUser.avatar,\n    avatarFileType: $scope.currentUser.avatarFileType,\n  };\n  \n  function refreshBlockedUsers()\n  {\n    ApiService.getBlockedUsers()\n    .then(function(users) {\n      $scope.blockedUsers = users;\n    });\n  }\n  \n  $scope.unblockUser = function(user) {\n    ApiService.unblockUser(user._id, onUnblock);\n  };\n  \n  function onUnblock(data)\n  {\n    refreshBlockedUsers();\n  }\n\n  $scope.$watch('avatar', function (newValue, oldValue, scope) {\n    if (newValue.filesize > 500000) {\n      scope.avatar = {};\n      scope.errormsg = \"Avatar too big\";\n    } else {\n      scope.user.avatar = newValue.base64;\n      scope.user.avatarFileType = newValue.filetype;\n    }\n  });\n  \n  $scope.submit = function() {\n    ApiService.editProfile($scope.user, onEdit);\n  };\n  \n  function onEdit(data) {\n    $scope.setCurrentUser(data);\n    $location.path(\"/intro\");\n  }\n}]);\n\nMyApp.service(\"ImgService\", function () {\r\n  this.showAvatar = function(user) {\r\n    if (user.avatar == \"\" || user.avatar == undefined)\r\n      return \"img/noavatar.png\";\r\n    return \"data:\" + user.avatarFileType + \";base64,\" + user.avatar;\r\n  };\r\n});\r\n\nMyApp.controller(\"IntroController\", [\"$scope\", \"$location\", \"ApiService\", function ($scope, $location, ApiService) {\n  ApiService.getRooms()\n  .then(function(data) {\n    $scope.rooms = data;\n    $scope.rooms.reverse();\n    $scope.rooms.forEach(function (room) {\n      room.messages.reverse();\n    });\n  });\n  $scope.attemptRoom = function(room) {\n    console.log(room.passwordHash);\n  };\n  $scope.getInRoom = function(room) {\n    $scope.pushRoom(room);\n    $location.path(\"/chatroom/\" + room._id);\n  };\n  $scope.sendPassword = function(room) {\n    ApiService.roomPassword(room._id, {roomPassword: room.roomPassword}, onSentPassword);\n  };\n  \n  function onSentPassword(data) {\n    $scope.getInRoom(data.room);\n  }\n  \n  $scope.formatDate = function(date) {\n    return new Date(date).toLocaleString();\n  };\n\n  $scope.chooseRoomColor = function(room, index) {\n    if (room.forbidden)\n      return \"disabled\";\n    if (Math.floor(index / 4) % 2 == 0) {\n      if (index % 2 == 0) return \"room1\";\n      return \"room2\";\n    }\n    if (index % 2 == 0) return \"room2\";\n    return \"room1\";\n  };\n}]);\n\nMyApp.directive(\"navTop\", function () {\n  return {\n    templateUrl: \"templates/layout-directives/nav-top2.html\",\n  };\n});\n\nMyApp.controller(\"LoginController\", [\"$scope\", \"$location\", \"ApiService\", function ($scope, $location, ApiService) {\n  $scope.submit = function() {\n    ApiService.login($scope.user, onLoggedIn, onError);\n  }\n  \n  function onLoggedIn(data) {\n    $scope.setCurrentUser(data.user);\n    $location.path(\"/intro\");\n  }\n  \n  function onError(err) {\n    console.error(\"Error could not login: \" + err);\n  }\n}]);\n\nMyApp.controller(\"MainController\", [\"$scope\", \"ApiService\", \"ImgService\", function ($scope, ApiService, ImgService) {\n  ApiService.getSessionToken();\n  $scope.setCurrentUser = function(user) {\n    $scope.currentUser = user;\n  };\n  $scope.setCurrentUser(ApiService.getSessionUser());\n  $scope.userLoggedIn = function() {\n    return ApiService.getSessionUser() != undefined;\n  };\n  $scope.pushRoom = function(room) {\n    var skip = false;\n    $scope.openRooms.forEach(function (r) {\n      if (r._id.toString() == room._id.toString())\n        skip = true;\n    });\n    if (!skip)\n      $scope.openRooms.push(room);\n  };\n  $scope.removeRoom = function(room) {\n    $scope.openRooms.splice($scope.openRooms.indexOf(room), 1);\n  };\n  $scope.openRooms = [];\n  $scope.showImage = function(user) {\n    return ImgService.showAvatar(user);\n  };\n  $scope.logout = function() {\n    ApiService.logout();\n    $scope.setCurrentUser(undefined);\n  };\n}]);\n\nMyApp.controller(\"OtherController\", [\"$scope\", function ($scope) {\n  $scope.filter = true;\n  $scope.toggleFilter = function () {\n    $scope.filter = !$scope.filter;\n  };\n}]);\n\nMyApp.controller(\"RegisterController\", [\"$scope\", \"$location\", \"ApiService\", function ($scope, $location, ApiService) {\n  $scope.user = {\n    nickname: \"\",\n    email: \"\",\n    password: \"\",\n    role: \"user\",\n    avatar: \"\",\n    avatarFileType: \"\"\n  };\n  \n  $scope.avatar = {};\n  $scope.$watch('avatar', function (newValue, oldValue, scope) {\n    if (newValue.filesize > 500000) {\n      scope.avatar = {};\n      scope.errormsg = \"Avatar too big\";\n    } else {\n      scope.user.avatar = newValue.base64;\n      scope.user.avatarFileType = newValue.filetype;\n    }\n  });\n  \n  $scope.submit = function() {\n    ApiService.register($scope.user, onRegister);\n  };\n  \n  function onRegister() {\n    $location.path(\"/login\");\n  }\n}]);\n\nMyApp.controller(\"RoomController\", [\"$scope\", \"$stateParams\", \"$location\", \"$anchorScroll\", \"ApiService\", function ($scope, $stateParams, $location, $anchorScroll, ApiService) {\n  function refreshMessages(x) {\n    ApiService.getRoom($stateParams.roomId)\n    .then(function(data) {\n      $scope.room = data.room;\n      $scope.messages = data.room.messages;\n      $scope.moderator = data.moderator;\n      $scope.messages.reverse();\n    });\n  }\n  \n  function refreshUsers(x) {\n    if (angular.equals($scope.currentUser, {}) || !$scope.moderator) {\n      return;\n    }\n    ApiService.getUsersForRoom($stateParams.roomId)\n    .then(function(data) {\n      $scope.members = data;\n    });\n  }\n\n  refreshMessages({});\n  setTimeout(function() {\n    $location.hash(\"sendbtn\");\n    $anchorScroll();  \n    $scope.newroom = {\n      name: $scope.room.name,\n      inviteonly: $scope.room.inviteonly,\n      unlisted: $scope.room.unlisted\n    };\n  }, 1000);\n  var autorefresh = setInterval(refreshMessages, 1000);\n  $scope.editSuccess = false;\n\n  $scope.send = function() {\n    ApiService.sendMessage($stateParams.roomId, $scope.newmsg, refreshMessages);\n    setTimeout(function() {\n      $location.hash(\"sendbtn\");\n      $anchorScroll();    \n    }, 1000);\n    $scope.newmsg = \"\";\n  };\n\n  $scope.editRoom = function() {\n    $scope.editSuccess = false;\n    if ($scope.changePassword) {\n      if ($scope.newroom == undefined || $scope.newroom.password == undefined)\n        $scope.newroom.password = \"\";\n    } else {\n      delete $scope.newroom.password;\n    }\n    ApiService.editRoom($stateParams.roomId, $scope.newroom, onEdit);\n  };\n  \n  function onEdit(x) {\n    $scope.editSuccess = true;\n    setTimeout(function(){$scope.editSuccess = false;}, 5000)\n    refreshMessages({});\n  }\n  \n  $scope.findUserByName = function() {\n    ApiService.findUserByName($scope.userToFind)\n    .then(function(data) {\n      $scope.foundUser = data;\n    });\n  };\n  \n  $scope.blockUser = function(userId) {\n    ApiService.blockUser(userId, refreshMessages);\n  };\n    \n  $scope.setMemberShip = function(user, role) {\n    ApiService.setMembership(user._id, $stateParams.roomId, role, refreshUsers);\n  };\n  \n  $scope.refUsers = function() {\n    refreshUsers({});\n  };\n  \n  $scope.formatDate = function(date) {\n    return new Date(date).toLocaleString();\n  };\n  \n  $scope.$on(\"$destroy\", function(){\n    clearInterval(autorefresh);\n  });\n}]);\n\nMyApp.controller(\"NewRoomController\", [\"$scope\", \"$location\", \"ApiService\", function ($scope, $location, ApiService) {\n  $scope.createRoom = function() {\n    ApiService.createRoom($scope.newroom, onCreatedRoom);\n  };\n  \n  function onCreatedRoom(data) {\n    $location.path(\"/room/\" + data.room._id);\n  }\n}]);\n"]}